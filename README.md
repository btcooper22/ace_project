# Connected Bradford scripts ("cBradford")

## Extraction scripts

These scripts use the 50k subset of the "Connected Bradford/Yorkshire" (henceforth cBradford) dataset to construct queries to extract relevant data from the full dataset. As such, each script generates (and is accompanied by in the queries folder) an SQL script which was then run against the full dataset. All scripts run of cBradford only return the results for the patients in the ACE dataset. Results are stored in .csv files in `data/cBradford`, and are not included in the git repository for data privacy reasons.

### `comorbidities.R`

This script searches the cBradford "condition" concepts for terms matching conditions known to be co-morbid with asthma. Conditions are classified by an upper and lower level, where the lower level generally uses synonyms, acronyms, or sub-groupings to ensure all relevant concepts are found. The query returns all ocurrances of each concept, along with person_id and date of diagnosis.

### `demographics.R`

This script extracts data on gender and ethnicity from cBradford.

### `prescriptions.R`

This script searches the cBradford "drug" concepts for terms matching a number of types of common medication. Specific drug names are grouped into major categories: Fast-acting bronchodilators, long-acting bronchodilators, antihistamines, prednisolone, and other steroids. The query returns all ocurrances of each concept, along with person_id and date of prescription.

### `visits.R`

This script searches the cBradford "visit" concepts for all those applying to ACE patients. This returns four main categories of visit (GP, ER, hospital as inpatient, hospital as outpatient) along with the date of the visit.

## `build_cbradford_variables.R`

This script uses the concept occurrance data generated by the previous scripts (and their accompanying SQL queries) to generate "variables of interest" which correlate with hospitalisation. It loads the ACE data through cBradford, then loads each of the outputs from above in turn. For each major variable type within these, it binarises and/or splits the variable by timeframe (as appropriate) to generate binary (TRUE/FALSE) variables. Univariate binomial GLMs are then used, and variables showing a significant link with hospitalisation are recorded in .csv files in `data/new_features` (excluded from git repository).

# Spatial data scripts

## `build_air_maps.R`

## `build_imd_maps.R`

## `investigate_air_imd.R`

## `build_gp_distances.R`

# Data preparation scripts

## `join_datasets.R`

## `import_data.Rmd`

# Analysis scripts

## Bootstrap aggregation workflow

### `bootstrap_aggregate_original.Rmd`

### `bootstrap_aggregate_additional.Rmd`

# Plotting/tabulating scripts

## `appendix_tables.R`

## `plot_results.R`

# Functions

## `inverse_logit.R`

## `load_connected_yorkshire.R`